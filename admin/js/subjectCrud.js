$(function(){var isAdmin=document.cookie.replace(/(?:(?:^|.*;\s*)adminType\s*\=\s*([^;]*).*$)|^.*$/,"$1");if(isAdmin==0){$('.forAdminOnly').hide()}
getAllSubjects(isAdmin);$('.addNewSubjectBtn').click(function(){getClassesInCheck("#addNewSubjectForm .listAllClasses")})});function getAllSubjects(isAdmin){var getSubjectSettings={"type":"GET","async":!0,"dataType":"json","url":"../api/subjects","headers":{"cache-control":"no-cache"}};$.ajax(getSubjectSettings).done(function(response){console.log(JSON.stringify(response));$('.subjectList').html("");var appendData="";$.each(response,function(key,value){appendData+="<tr>"+"<td>"+value.subject_id+"</td>"+"<td>"+value.subject_name+"</td>"+"<td><div class='btn-group btn-group-xs'><button class='btn btn-primary indSubject' value='"+value.subject_id+"' data-target='#editSubject' data-toggle='modal'>"+"<span class='fa fa-edit'></span> Edit</button><button value='"+value.subject_id+"' class='indSubjectDel btn btn-danger' data-target='#deleteSubject' data-toggle='modal'>"+"<span class='fa fa-trash'></span></button></div></td></tr>";if(isAdmin==0){$('.subjectBox button').hide();$('.subjectBox .details h5').addClass('text-center').addClass('offAdmin')}
else{}});$('.subjectList').html(appendData);imageErrorFix();$('.indSubject').click(function(e){e.preventDefault();var valueX="";valueX=$(this).attr("value");editSubject(valueX)});$('.indSubjectDel').click(function(e){e.preventDefault();var delValueX=$(this).attr("value");delSubject(delValueX)})})}
function getClassesInCheck(location){var getClassesSettings={"type":"GET","async":!0,"dataType":"json","url":"../api/classes","headers":{}};$.ajax(getClassesSettings).success(function(response){$(location).html("");var appendData="";$.each(response,function(key,value){appendData+="<label class='checkbox-inline'><input type='checkbox' class='classCheckbox' name='add_class' value='"+value.class_id+"'>"+value.class_name+"</label>"});$(location).html(appendData)})}
function beforeSubmit(){var obj={};var checkboxArray=[];$.each($('#addNewSubjectForm .classCheckbox'),function(){if($(this).prop("checked")==!0){checkboxArray.push($(this).val())}});$('.subjectNameLabel').text("Subject Name");$('.classNameLabel').text("Class");$('.termNameLabel').text("Term");$('.subjectLogoLabel').text("Subject Image");$('label').removeClass('text-danger');if(!minmax(3,20,"#addNewSubjectForm #subjectName","A Real term name is required","#addNewSubjectForm .subjectNameLabel")){obj.status=!1}
else{obj.status=!0}
var subject=$('#subjectName').val();var appendData=[];$.each(checkboxArray,function(index,value){appendData.push(value)});var formx={"subjectName":subject,"sDescription":"No description","subject":"new","classes":appendData};obj.postdata=formx;return obj}
$("#addNewSubjectForm").ajaxify({url:'../api/subjects/class_subjects',validator:beforeSubmit,onSuccess:callBackMethod,dataType:'text'});var isAdmin=document.cookie.replace(/(?:(?:^|.*;\s*)adminType\s*\=\s*([^;]*).*$)|^.*$/,"$1");function callBackMethod(response){checkboxArray=[];appendData=[];getAllSubjects(isAdmin);$('#addNewSubjectForm')[0].reset();notify("Subject added sucessfully","success")}
function editSubject(id){console.log(id);var getSubjectByIdSettings={"async":!0,"dataType":"json","type":"GET","url":"../api/subjects/"+id,"headers":{"cache-control":"no-cache"}};$.ajax(getSubjectByIdSettings).done(function(response){$.each(response,function(key,value){$('#editSubject #editSubjectForm #subjectName').val(value.subject_name);$('#editSubject #editSubjectForm .pic').attr("src",value.subject_logo)});function getClassesChecked(){var getClassesSettings={"type":"GET","async":!0,"dataType":"json","url":"../api/subjects/classes/"+id,"headers":{"cache-control":"no-cache"}};$.ajax(getClassesSettings).success(function(response){$('#editSubjectForm .listCheckedClasses').html("");$.each(response,function(key,value){var appendData="<input type='checkbox' checked class='classCheckbox' name='remove_class' value='"+value.class_id+"'><label class='text-primary' for='"+value.short_class_name+"' >"+value.class_name+"</label>&nbsp;&nbsp;&nbsp;";$('#editSubjectForm .listCheckedClasses').append(appendData)})})}
getClassesChecked()});$("#editSubject #editSubjectForm .img-avail").show();$("#editSubject #editSubjectForm .img-upload").hide();$("#editSubject #editSubjectForm .removeImg").show();$("#editSubject #editSubjectForm .cancelRemoveImg").hide();$("#editSubject #editSubjectForm .img-upload").hide();$("#editSubject #editSubjectForm .cancelRemoveImg").hide();$("#editSubject #editSubjectForm .img-upload #classLogoEdit").val("");$('#editSubject #editSubjectForm .removeImg').click(function(){$("#editSubject #editSubjectForm .img-avail").hide();$("#editSubject #editSubjectForm .img-upload").slideDown();$("#editSubject #editSubjectForm .removeImg").hide();$("#editSubject #editSubjectForm .cancelRemoveImg").fadeIn();$("#editSubject #editSubjectForm .cancelRemoveImg").click(function(){$("#editSubject #editSubjectForm .img-avail").fadeIn();$("#editSubject #editSubjectForm .img-upload").hide();$("#editSubject #editSubjectForm .img-upload #classLogoEdit").val("");$("#editSubject #editSubjectForm .removeImg").fadeIn();$("#editSubject #editSubjectForm .cancelRemoveImg").hide()})});function beforeSubmit(){var obj={};var checkboxArray=[];$.each($('#editSubjectForm .classCheckbox'),function(){if($(this).prop("checked")===!0){checkboxArray.push($(this).val())}});var unchecked=[];$.each($('#editSubjectForm .listCheckedClasses .classCheckbox'),function(){if(!$(this).is(":checked")){unchecked.push($(this).val())}});$('#editSubjectForm .subjectNameLabel').text("Subject Name");$('#editSubjectForm .classNameLabel').text("Class");$('#editSubjectForm .termNameLabel').text("Term");$('#editSubjectForm .subjectLogoLabel').text("Subject Image");$('label').removeClass('text-danger');if(!minmax(3,30,"#editSubjectForm  #subjectName","A Real Subject name is required","#editSubjectForm .subjectNameLabel")){obj.status=!1}
else{obj.status=!0}
var subject=$('#editSubjectForm #subjectName').val();var appendData=[];$.each(checkboxArray,function(index,value){appendData.push(value)});var formz={"subjectName":subject,"sDescription":"No description","add_class":appendData,"remove_class":unchecked};obj.postdata=formz;return obj}
$("#editSubjectForm").ajaxify({url:"../api/subjects/edit/"+id,validator:beforeSubmit,onSuccess:editCallBackMethod,dataType:'text'});function editCallBackMethod(){checkboxArray=[];appendData=[];notify("Subject details updated sucessfully",'success');$(".modal-backdrop").fadeOut();$(".modal").modal("hide");var isAdmin=document.cookie.replace(/(?:(?:^|.*;\s*)adminType\s*\=\s*([^;]*).*$)|^.*$/,"$1");getAllSubjects(isAdmin)}}
function delSubject(id){console.log(id);$('#deleteSubject .delBtn').click(function(){var delSubjectSettings={"type":"GET","async":!0,"dataType":"json","url":"../api/subjects/delete/"+id,"headers":{"cache-control":"no-cache"}};$.ajax(delSubjectSettings).success(function(response){console.log("Subject Deleted Succesfully");getAllSubjects()})})}